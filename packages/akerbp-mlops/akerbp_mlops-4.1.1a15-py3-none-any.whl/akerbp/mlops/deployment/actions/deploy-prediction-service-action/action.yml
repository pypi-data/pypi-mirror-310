name: "deploy-prediction-service"
description: "Deploy the prediction service to a given environment"
inputs:
  model_env:
    description: "The environment to deploy the model to"
    required: true
  mlops_version:
    description: "The version of the mlops package to use to deploy"
    required: true
runs:
  using: "composite"

  steps:
    - name: Set up mlops environment
      uses: ./.github/actions/setup-mlops-action
      with:
        model_env: ${{ inputs.model_env }}
        service_name: prediction
        install_poetry: false
        python_version: PYTHON_VERSION_GOES_HERE

    - name: Install specified mlops version
      shell: "bash"
      run: |
        pip install "akerbp-mlops[cdf]==${{ inputs.mlops_version }}"

    - name: Deploy prediction service
      shell: "bash"
      run: |
        deploy_prediction_service

    - name: Tag model version
      shell: "bash"
      run: |
        tag_model_version
