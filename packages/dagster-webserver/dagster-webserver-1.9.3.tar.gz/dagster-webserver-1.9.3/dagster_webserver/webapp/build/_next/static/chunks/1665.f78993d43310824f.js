"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1665],{31665:function(e,n,t){t.r(n),t.d(n,{RunRoot:function(){return ez},default:function(){return eM}});var i=t(73235),r=t(52322),o=t(14934),s=t(74580),l=t(43212),a=t(37483),u=t(35292),c=t(39013),d=t(74188),p=t(2784),x=t(7267),m=t(47933),h=t(43111),g=t(35002),j=t(38491),f=t(72330),v=t(89776),y=t(35505),S=t(50798),w=t(22351),I=t(16744),b=t(17650),C=t(83846),O=t(51154),R=t(68300),k=t(878),N=t(6484),T=t(8068),E=t(98832),_=t(99590),A=t(44900),D=t(13549),F=t(51701),L=t(88257),V=t(20171);let U=e=>{(0,p.useEffect)(()=>{let n=document.querySelector('link[rel="icon"][type="image/svg+xml"]');if(!n)return;let t=n.getAttribute("href");return n.setAttribute("href",e),()=>{t&&n.setAttribute("href",t)}},[e])};var K=t(4378),J=t(34219);let z=e=>{switch(e){case L.VOA.FAILURE:return"/favicon-run-failed.svg";case L.VOA.SUCCESS:return"/favicon-run-success.svg";case L.VOA.STARTING:case L.VOA.STARTED:case L.VOA.CANCELING:return"/favicon-run-pending.svg";default:return"/favicon.svg"}},M=(0,p.memo)(e=>{let{run:n,runId:t}=e,[i,o]=(0,N.Bz)(),[s,l]=(0,K.q)({queryKey:"selection",defaults:{selection:""}});U(n?z(n.status):"/favicon.svg"),(0,V.j)(n?"".concat((0,A.pv)(n.pipelineName)?"":n.pipelineName," ").concat(t.slice(0,8)," [").concat(n.status,"]"):"Run: ".concat(t));let a=(e,n)=>{let t=n.find(n=>"ExecutionStepFailureEvent"===n.__typename&&n.stepKey===e);t&&(0,T._K)({body:(0,r.jsx)(_.T9,{error:t})})},u=e=>{l(e),o({...i,logQuery:"*"!==e?[{token:"query",value:e}]:[]})},c=(0,J.FE)("RunLogs");return(0,r.jsx)(O.A.Provider,{value:n,children:(0,r.jsx)(w.C,{runId:t,children:e=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(P,{dependency:c}),(0,r.jsx)(R.jp,{logs:e,children:l=>(0,r.jsx)(Q,{run:n,runId:t,logs:e,logsFilter:i,metadata:l,selectionQuery:s,onSetLogsFilter:o,onSetSelectionQuery:u,onShowStateDetails:a})})]})},t)})}),P=e=>{let{dependency:n}=e;return p.useLayoutEffect(()=>{n.completeDependency(J.Os.SUCCESS)},[n]),null},q=e=>{switch(e){case"stdout":return b.hi.stdout;case"stderr":return b.hi.stderr;default:return b.hi.structured}},Q=e=>{let{run:n,runId:t,logs:i,logsFilter:s,metadata:l,selectionQuery:u,onSetLogsFilter:c,onSetSelectionQuery:d}=e,[x,m]=(0,K.q)({queryKey:"logType",defaults:{logType:b.hi.structured}}),y=q(x),[w,O]=p.useState(null),R=JSON.stringify(Object.keys(l.steps).sort()),N=p.useMemo(()=>JSON.parse(R),[R]),T=(null==n?void 0:n.executionPlan)&&(0,F.J)(null==n?void 0:n.executionPlan,l.steps),_=p.useMemo(()=>T&&u&&"*"!==u?(0,E.V)(T,u).all.map(e=>e.name):[],[T,u]),{logCaptureInfo:A,computeLogFileKey:L,setComputeLogFileKey:V}=(0,k.r)({stepKeys:N,selectionStepKeys:_,metadata:l,defaultToFirstStep:!1}),U=T?s.logQuery.filter(e=>e.token&&"query"===e.token).reduce((e,n)=>(e.push(...(0,E.V)(T,n.value).all.map(e=>e.name)),e),[]):[],[J,z]=p.useState(null),M=p.useRef(null);p.useEffect(()=>{if(M.current){let e=M.current.getSize();100===e?z("top"):0===e&&z("bottom")}},[]);let P="top"===J,Q="bottom"===J,G=()=>{var e;null===(e=M.current)||void 0===e||e.changeSize(50),z(null)};return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(v.O,{ref:M,axis:"vertical",identifier:"run-gantt",firstInitialPercent:35,firstMinSize:56,first:n?"QUEUED"===n.status?(0,r.jsx)(D.Fu,{run:n}):n.executionPlan&&T?(0,r.jsx)(h.S,{region:"gantt chart",children:(0,r.jsx)(D.hj,{options:{mode:D.hS.WATERFALL_TIMED},toolbarActions:(0,r.jsxs)(o.x,{flex:{direction:"row",alignItems:"center",gap:12},children:[(0,r.jsx)(g.u,{content:P?"Collapse":"Expand",children:(0,r.jsx)(j.zx,{icon:(0,r.jsx)(f.JO,{name:P?"collapse_arrows":"expand_arrows"}),onClick:P?G:()=>{var e;null===(e=M.current)||void 0===e||e.changeSize(100),z("top")}})}),(0,r.jsx)(C.NX,{run:n,graph:T,metadata:l,selection:{query:u,keys:_}})]}),runId:t,graph:T,metadata:l,selection:{query:u,keys:_},onClickStep:(e,n)=>{let t;let i=_.indexOf(e),r='"'.concat(e,'"');if(n.shiftKey)t=[..._.map(e=>u.includes('"'.concat(e,'"'))?'"'.concat(e,'"'):e)],-1!==i?t.splice(i,1):t.push(r);else if(1===_.length&&-1!==i)t=[];else{t=[r];let n=(0,k.c)(l.logCaptureSteps,e);n&&V(n)}d(t.join(", ")||"*")},onSetSelection:d,focusedTime:s.focusedTime})}):(0,r.jsx)(a.t,{icon:"error",title:"Unable to build execution plan"}):(0,r.jsx)(D.ZW,{runId:t}),secondMinSize:56,second:(0,r.jsx)(h.S,{region:"logs",children:(0,r.jsxs)(H,{children:[(0,r.jsx)(b.KZ,{logType:y,onSetLogType:e=>m(b.hi[e]),filter:s,onSetFilter:c,steps:N,metadata:l,computeLogFileKey:L,onSetComputeLogKey:V,computeLogUrl:w,counts:i.counts,isSectionExpanded:Q,toggleExpanded:Q?G:()=>{var e;null===(e=M.current)||void 0===e||e.changeSize(0),z("bottom")}}),y!==b.hi.structured?L?(0,r.jsx)(S.h,{logKey:L?[t,"compute_logs",L]:[],logCaptureInfo:A,visibleIOType:b.hi[y],onSetDownloadUrl:O}):(0,r.jsx)($,{type:y}):(0,r.jsx)(I.S,{logs:i,filter:s,filterStepKeys:U,filterKey:"".concat(JSON.stringify(s)),metadata:l})]})})})})},H=y.ZP.div.withConfig({componentId:"sc-c94ca168-0"})(["display:flex;flex-direction:column;height:100%;"]),$=e=>{let{type:n}=e;return(0,r.jsx)(o.x,{flex:{direction:"row",grow:1,alignItems:"center",justifyContent:"center"},style:{background:c.v8()},children:(0,r.jsx)(a.t,{title:"Select a step to view ".concat(n),icon:"warning",description:"Select a step on the Gantt chart or from the dropdown above to view logs."})})};var G=t(40250),B=t(20958);function W(){let e=(0,i._)(["\n  query RunAssetChecksQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        assetChecks {\n          name\n          assetKey {\n            path\n          }\n        }\n      }\n    }\n  }\n"]);return W=function(){return e},e}let Z=e=>{let{run:n}=e,t=(0,A.pv)(n.pipelineName),{data:i,loading:o}=(0,B.aM)(X,{variables:{runId:n.id},skip:t});if(o||!i||"Run"!==i.pipelineRunOrError.__typename)return null;let s=t?n.assetCheckSelection:i.pipelineRunOrError.assetChecks;return(0,r.jsx)(G.m,{useTags:!0,assetChecks:s})},X=(0,B.Ps)(W());var Y=t(33182);function ee(){let e=(0,i._)(["\n  query RunAssetsQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        assets {\n          id\n          key {\n            path\n          }\n        }\n      }\n    }\n  }\n"]);return ee=function(){return e},e}let en=e=>{let{run:n}=e,t=(0,A.pv)(n.pipelineName),{data:i,loading:o}=(0,B.aM)(et,{variables:{runId:n.id},skip:t,fetchPolicy:"no-cache"});if(o||!i||"Run"!==i.pipelineRunOrError.__typename)return null;let s=t?(0,Y.Bo)(n):i.pipelineRunOrError.assets.map(e=>e.key);return(0,r.jsx)(G.h,{useTags:!0,assetKeys:s})},et=(0,B.Ps)(ee());var ei=t(93836),er=t(34147),eo=t(55010),es=t(60603),el=t(23102),ea=t(23808),eu=t(23119),ec=t(74824),ed=t(59351),ep=t(96569),ex=t(4128),em=t(50309),eh=t(85227),eg=t(6023),ej=t(88610),ef=t(10539);let ev=e=>{var n,t;let{run:i,isJob:o}=e,{runConfigYaml:s}=i,l=i.hasRunMetricsEnabled,[a,u]=(0,p.useState)(null),{rootServerURI:c}=(0,p.useContext)(ex.I),{refetch:d}=(0,p.useContext)(Y.Lw),m=(0,eh.m)(),h=(0,x.k6)(),[v]=(0,B.Db)(eg.FREE_CONCURRENCY_SLOTS_MUTATION),y=async()=>{m(s),await (0,em.B7)({intent:"success",icon:"copy_to_clipboard_done",message:"Copied!"})},S=async()=>{var e;(null===(e=(await v({variables:{runId:i.id}})).data)||void 0===e?void 0:e.freeConcurrencySlots)&&await (0,em.B7)({intent:"success",icon:"check_circle",message:"Freed concurrency slots"})},w=(0,ef.$y)({repositoryName:null===(n=i.repositoryOrigin)||void 0===n?void 0:n.repositoryName,repositoryLocationName:null===(t=i.repositoryOrigin)||void 0===t?void 0:t.repositoryLocationName,run:i,isJob:o});return(0,r.jsxs)("div",{children:[(0,r.jsxs)(er.Z,{direction:"row",spacing:8,children:[w.disabledReason?(0,r.jsx)(g.u,{content:w.disabledReason,useDisabledButtonTooltipFix:!0,children:(0,r.jsx)(j.zx,{icon:(0,r.jsx)(f.JO,{name:w.icon}),disabled:!0,children:w.label})}):(0,r.jsx)(ej.A,{icon:(0,r.jsx)(f.JO,{name:w.icon}),to:w.to,children:w.label}),(0,r.jsx)(j.zx,{icon:(0,r.jsx)(f.JO,{name:"tag"}),onClick:()=>u("config"),children:"View tags and config"}),(0,r.jsx)(eo.J,{position:"bottom-right",content:(0,r.jsxs)(es.v2,{children:[(0,r.jsx)(g.u,{content:"Loadable in dagster-webserver-debug",position:"left",targetTagName:"div",children:(0,r.jsx)(es.sN,{text:"Download debug file",icon:"download_for_offline",onClick:()=>window.open("".concat(c,"/download_debug/").concat(i.id))})}),i.status===L.VOA.QUEUED?(0,r.jsx)(es.sN,{tagName:"button",icon:"history_toggle_off",text:"View queue criteria",intent:"none",onClick:()=>u("queue-criteria")}):null,l&&el.G?(0,r.jsx)(es.sN,{tagName:"button",icon:"asset_plot",text:"View container metrics",intent:"none",onClick:()=>u("metrics")}):null,i.hasConcurrencyKeySlots&&ed.cv.has(i.status)?(0,r.jsx)(es.sN,{text:"Free concurrency slots",icon:"lock",onClick:S}):null,i.hasDeletePermission?(0,r.jsx)(es.sN,{icon:"delete",text:"Delete",intent:"danger",onClick:()=>u("delete")}):null]}),children:(0,r.jsx)(j.zx,{icon:(0,r.jsx)(f.JO,{name:"expand_more"})})})]}),(0,r.jsx)(ec.U,{isOpen:"config"===a,onClose:()=>u(null),copyConfig:()=>y(),mode:i.mode,runConfigYaml:i.runConfigYaml,tags:i.tags,isJob:o}),i.status===L.VOA.QUEUED?(0,r.jsx)(eu.f,{run:i,isOpen:"queue-criteria"===a,onClose:()=>u(null)}):null,l&&el.G?(0,r.jsx)(el.G,{runId:i.id,isOpen:"metrics"===a,onClose:()=>u(null)}):null,i.hasDeletePermission?(0,r.jsx)(ea.N,{isOpen:"delete"===a,onClose:()=>u(null),onComplete:()=>{i.repositoryOrigin?h.push((0,ef.jT)({repoName:i.repositoryOrigin.repositoryName,repoLocation:i.repositoryOrigin.repositoryLocationName,pipelineName:i.pipelineName,isJob:o,path:"/runs"})):u(null)},onTerminateInstead:()=>u("terminate"),selectedRuns:{[i.id]:i.canTerminate}}):null,i.hasTerminatePermission?(0,r.jsx)(ep.A,{isOpen:"terminate"===a,onClose:()=>u(null),onComplete:()=>{d()},selectedRuns:{[i.id]:i.canTerminate}}):null]})};var ey=t(67994),eS=t(43984),ew=t(68283),eI=t(71406),eb=t(86269);let eC=e=>{let{loading:n,run:t}=e;return(0,r.jsxs)(r.Fragment,{children:[(null==t?void 0:t.startTime)?(0,r.jsx)(eo.J,{interactionKind:"hover",placement:"bottom",content:(0,r.jsx)(o.x,{padding:16,children:(0,r.jsx)(ew.s9,{run:t,loading:n})}),children:(0,r.jsx)(l.V,{icon:"schedule",children:(0,r.jsx)(eb.v,{timestamp:t.startTime,timeFormat:{showSeconds:!0,showTimezone:!1}})})}):t.updateTime?(0,r.jsx)(l.V,{icon:"schedule",children:(0,r.jsx)(eb.v,{timestamp:t.updateTime,timeFormat:{showSeconds:!0,showTimezone:!1}})}):void 0,(null==t?void 0:t.startTime)&&(null==t?void 0:t.endTime)?(0,r.jsx)(eo.J,{interactionKind:"hover",placement:"bottom",content:(0,r.jsx)(o.x,{padding:16,children:(0,r.jsx)(ew.s9,{run:t,loading:n})}),children:(0,r.jsx)(l.V,{icon:"timer",children:(0,r.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:(null==t?void 0:t.startTime)?(0,eI.R4)(((null==t?void 0:t.endTime)*1e3||Date.now())-(null==t?void 0:t.startTime)*1e3):"–"})})}):null]})};var eO=t(25032),eR=t(89891),ek=t(53664),eN=t(44030);let eT=e=>{let{instigationSelector:n,instigationType:t,tickId:i}=e,[s,a]=(0,p.useState)(!1),u=t===eS.H.ScheduleName?"schedule":"sensors",{name:c}=n;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.V,{icon:u,children:(0,r.jsxs)(o.x,{flex:{direction:"row"},children:[(0,r.jsx)("span",{children:"Launched by\xa0"}),(0,r.jsx)(eR.Z,{onClick:()=>a(!0),children:(0,r.jsx)("div",{style:{maxWidth:"140px"},children:(0,r.jsx)(ek.g,{text:c})})})]})}),(0,r.jsx)(eN.X,{isOpen:s,tickResultType:"runs",onClose:()=>a(!1),instigationSelector:n,tickId:i})]})};var eE=t(49438),e_=t(69737),eA=t(75442);let eD=new Intl.Collator(navigator.language,{sensitivity:"base"}),eF=e=>{let{assetKeys:n,evaluationId:t}=e,i=(0,p.useMemo)(()=>[...n].sort((e,n)=>eD.compare(e.path.join("/"),n.path.join("/"))),[n]);return(0,r.jsx)(eo.J,{placement:"bottom",content:(0,r.jsxs)("div",{style:{width:"340px"},children:[(0,r.jsx)(o.x,{padding:{vertical:8,horizontal:12},border:"bottom",style:{fontWeight:600},children:"Automation condition"}),(0,r.jsx)(o.x,{flex:{direction:"column",gap:12},padding:{vertical:12},style:{maxHeight:"220px",overflowY:"auto"},children:i.map(e=>{let n=(0,eA.p)(e,{view:"automation",evaluation:t});return(0,r.jsxs)(o.x,{padding:{vertical:8,left:12,right:16},flex:{direction:"row",justifyContent:"space-between",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,r.jsxs)(o.x,{flex:{direction:"row",alignItems:"center",gap:8},style:{overflow:"hidden"},children:[(0,r.jsx)(f.JO,{name:"asset"}),(0,r.jsx)(ek.g,{text:e.path.join("/")})]}),(0,r.jsx)(m.rU,{to:n,style:{whiteSpace:"nowrap"},children:"View evaluation"})]},n)})})]}),interactionKind:"hover",children:(0,r.jsx)(l.V,{icon:"automation_condition",children:"Automation condition"})})};var eL=t(33847),eV=t(92199),eU=t(65822),eK=t(60082);function eJ(){let e=(0,i._)(["\n  query RunRootQuery($runId: ID!) {\n    pipelineRunOrError(runId: $runId) {\n      ... on Run {\n        id\n        ...RunPageFragment\n      }\n    }\n  }\n\n  ","\n"]);return eJ=function(){return e},e}let ez=()=>{var e;(0,e_.Px)();let{runId:n}=(0,x.UO)();(0,V.j)(n?"Run ".concat(n.slice(0,8)):"Run");let{data:t,loading:i}=(0,B.aM)(eq,{variables:{runId:n}}),a=(null==t?void 0:t.pipelineRunOrError.__typename)==="Run"?t.pipelineRunOrError:null,u=null==a?void 0:a.pipelineSnapshotId,c=(0,eK.n)(a),d=(null==c?void 0:c.match)?(0,eU.kQ)(c.match.repository.name,c.match.repositoryLocation.name):null,m=(0,p.useMemo)(()=>!!(a&&c&&(0,eV.E8)(c.match,a.pipelineName)),[a,c]),h=(0,p.useMemo)(()=>(null==a?void 0:a.tags.find(e=>e.key===eS.H.AssetEvaluationID))||null,[a]),g=(0,p.useMemo)(()=>{if(d){let e=(null==a?void 0:a.tags)||[],n=e.find(e=>e.key===eS.H.TickId);if(n){let t=e.find(e=>e.key===eS.H.ScheduleName||e.key===eS.H.SensorName);if(t){let e={name:t.value,repositoryName:d.name,repositoryLocationName:d.location};return{tickId:n.value,instigationType:t.key,instigationSelector:e}}}}return null},[a,d]),j=null==a?void 0:a.tags.find(e=>e.key===eS.H.Partition);return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",minWidth:0,width:"100%",height:"100%",overflow:"hidden"},children:[(0,r.jsx)(o.x,{flex:{direction:"row",alignItems:"flex-start"},style:{position:"relative",zIndex:1},children:(0,r.jsx)(s.m,{title:(0,r.jsx)(eQ,{run:a,runId:n}),tags:a?(0,r.jsxs)(o.x,{flex:{direction:"row",alignItems:"flex-start",gap:12,wrap:"wrap"},children:[(0,r.jsx)(ey.KG,{status:a.status}),(0,A.pv)(a.pipelineName)?null:(0,r.jsxs)(l.V,{icon:"run",children:["Run of"," ",(0,r.jsx)(eL.h,{pipelineName:null==a?void 0:a.pipelineName,pipelineHrefContext:d||"repo-unknown",snapshotId:u,size:"small",isJob:m})]}),g?(0,r.jsx)(eT,{instigationSelector:g.instigationSelector,instigationType:g.instigationType,tickId:g.tickId}):null,j&&(0,r.jsx)(eS.i,{tag:j}),(0,r.jsx)(en,{run:a}),(0,r.jsx)(Z,{run:a}),(0,r.jsx)(eC,{run:a,loading:i}),h&&(null===(e=a.assetSelection)||void 0===e?void 0:e.length)?(0,r.jsx)(eF,{assetKeys:a.assetSelection,evaluationId:h.value}):null]}):null,right:a?(0,r.jsx)(ev,{run:a,isJob:m}):null})}),(0,r.jsx)(eP,{data:t,runId:n})]})};var eM=ez;let eP=e=>{let{data:n,runId:t}=e;return n&&n.pipelineRunOrError?"Run"!==n.pipelineRunOrError.__typename?(0,r.jsx)(o.x,{padding:{vertical:64},children:(0,r.jsx)(a.t,{icon:"error",title:"No run found",description:"The run with this ID does not exist or has been cleaned up."})}):(0,r.jsx)(M,{run:n.pipelineRunOrError,runId:t}):(0,r.jsx)(M,{run:void 0,runId:t})},eq=(0,B.Ps)(eJ(),ei.tQ),eQ=e=>{let{run:n,runId:t}=e,{flagLegacyRunsPage:i}=(0,eE.gV)(),o=(0,p.useMemo)(()=>null==n?void 0:n.tags.find(e=>e.key===eS.H.Backfill),[n]);if(!i&&o){var s;return(0,r.jsxs)(u.X6,{children:[(0,r.jsx)(m.rU,{to:"/runs",style:{color:c.$()},children:"Runs"})," / ",(0,r.jsx)(m.rU,{to:(0,eO.M)(o.value,!!(null==n?void 0:null===(s=n.assetSelection)||void 0===s?void 0:s.length)),style:{color:c.$()},children:o.value})," / ",t.slice(0,8)]})}return(0,r.jsxs)(u.X6,{style:{display:"flex",flexDirection:"row",gap:6},children:[(0,r.jsx)(m.rU,{to:"/runs",children:"Runs"}),(0,r.jsx)("span",{children:"/"}),(0,r.jsx)("span",{style:{fontFamily:d.b.monospace},children:t.slice(0,8)})]})}}}]);
//# sourceMappingURL=1665.f78993d43310824f.js.map