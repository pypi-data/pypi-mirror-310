import{d as G,ap as ne,aq as fe,r as x,o,e as a,l as se,ar as _e,f as d,C as ge,x as z,ak as R,t as D,P as F,_ as Q,i as K,a as H,c as m,m as V,F as B,s as U,v as ye,q as O,J as w,Y as le,K as be,w as J,k as Ce,as as we,L as j,N as ie,u as ke,y as re,z as ce,n as Se}from"./index-9bD4GQJ-.js";const Te={key:0,class:"BuilderSidebarTitleSearch"},Ie={key:1,class:"BuilderSidebarTitleSearch"},$e={class:"material-symbols-outlined"},Be=G({__name:"BuilderSidebarTitleSearch",props:ne({icon:{type:String,required:!0},title:{type:String,required:!0},disabled:{type:Boolean,required:!1}},{modelValue:{type:String,default:""},modelModifiers:{}}),emits:ne({},["update:modelValue"]),setup(v){const l=fe(v,"modelValue"),h=x(null),k=x(!1);async function _(){k.value=!k.value,k.value?(await F(),h.value.focus()):l.value=""}return(g,y)=>k.value?(o(),a("div",Te,[se(d("input",{ref_key:"searchInput",ref:h,"onUpdate:modelValue":y[0]||(y[0]=T=>l.value=T),type:"text",placeholder:"Search..."},null,512),[[_e,l.value]]),ge(g.$slots,"default",{},void 0,!0),d("i",{class:z([{disabled:v.disabled},"searchIcon material-symbols-outlined"]),"data-writer-tooltip":"Close","data-writer-tooltip-placement":"bottom",tabindex:"0","data-automation-action":"close",onKeydown:R(_,["enter"]),onClick:_}," close ",34)])):(o(),a("div",Ie,[d("i",$e,D(v.icon),1),d("h3",null,D(v.title),1),d("i",{"data-writer-tooltip":"Search","data-writer-tooltip-placement":"bottom",class:"searchIcon material-symbols-outlined",tabindex:"0","data-automation-action":"search",onKeydown:R(_,["enter"]),onClick:_}," search ",32)]))}}),de=Q(Be,[["__scopeId","data-v-2924d0f1"]]),xe={class:"BuilderSidebarToolbar"},De={class:"categories"},Me={key:0,class:"category"},Ve={class:"title"},Le={class:"material-symbols-outlined"},Pe=["onClick"],Ee={class:"material-symbols-outlined"},Ae=["aria-expanded"],Ne=["data-writer-tooltip","data-component-type","onDragstart"],je={key:0,class:"material-symbols-outlined",title:"(Custom component template)"},Oe=G({__name:"BuilderSidebarToolbar",setup(v){const l=K(H.core),h=K(H.builderManager),{removeInsertionCandidacy:k}=le(l),_=x(""),g=x({Root:{isVisible:!1},Layout:{icon:"space_dashboard",isCollapsed:!1},Content:{icon:"toc",isCollapsed:!1},Input:{icon:"input",isCollapsed:!1},Embed:{icon:"integration_instructions",isCollapsed:!1},Writer:{icon:"Notes",isCollapsed:!1},Logic:{icon:"Laps",isCollapsed:!1},Other:{icon:"dynamic_feed",isCollapsed:!1}});function y(i){var r;return((r=g.value[i])==null?void 0:r.isVisible)===!1?!1:Object.keys(M.value[i]??{}).length>0}function T(i){const r=g.value[i];r.isCollapsed=!r.isCollapsed}const M=m(()=>{const i=l.getSupportedComponentTypes(),r={};return i.map(n=>{const c=l.getComponentDefinition(n);if(!((c.toolkit??"core")==W.value)||!(_.value===""||c.name.toLocaleLowerCase().includes(_.value.toLocaleLowerCase())))return;const I=Object.keys(g.value).includes(c.category);let e;I?e=c.category:e="Other",r[e]||(r[e]={}),r[e][n]=c}),r}),W=m(()=>h.getMode()=="workflows"?"workflows":"core"),L=(i,r)=>{h.setSelection(null),i.dataTransfer.setData(`application/json;writer=${r},`,"{}")},P=i=>{k(i)};return(i,r)=>(o(),a("div",xe,[V(de,{modelValue:_.value,"onUpdate:modelValue":r[0]||(r[0]=n=>_.value=n),title:"Toolkit",icon:"handyman"},null,8,["modelValue"]),d("div",De,[(o(!0),a(B,null,U(g.value,(n,c)=>(o(),a(B,{key:c},[y(c)?(o(),a("div",Me,[d("div",Ve,[d("i",Le,D(n.icon??"question_mark"),1),d("h4",null,D(c),1),d("button",{class:"drop-arrow",onClick:p=>T(c)},[d("i",Ee,D(n.isCollapsed?"expand_more":"expand_less"),1)],8,Pe)]),se(d("div",{class:"components","aria-expanded":!n.isCollapsed},[(o(!0),a(B,null,U(M.value[c],(p,C)=>(o(),a("div",{key:C,class:"component button","data-writer-tooltip":p.description,"data-writer-tooltip-placement":"right",draggable:"true","data-component-type":C,onDragend:r[1]||(r[1]=I=>P(I)),onDragstart:I=>L(I,C)},[O(D(p.name??C)+" ",1),C.startsWith("custom_")?(o(),a("i",je,"manga")):w("",!0)],40,Ne))),128))],8,Ae),[[ye,!n.isCollapsed]])])):w("",!0)],64))),128))])]))}}),Ke=Q(Oe,[["__scopeId","data-v-a1d37eb2"]]),Y=v=>(re("data-v-c548a629"),v=v(),ce(),v),He={class:"BuilderTreeBranch"},We=["title","data-branch-component-type","data-branch-component-id","draggable"],qe={key:0,class:"material-symbols-outlined"},Fe={key:1,class:"material-symbols-outlined"},Re={class:"type"},Ue=Y(()=>d("i",{class:"material-symbols-outlined"},"bolt",-1)),Ge=Y(()=>d("i",{class:"material-symbols-outlined"},"visibility_off",-1)),Qe=Y(()=>d("i",{class:"material-symbols-outlined"},"terminal",-1)),ze={key:4,class:"preview"},Xe={key:0,class:"children"},Je=G({__name:"BuilderTreeBranch",props:{componentId:{},matchingComponents:{}},setup(v){const l=K(H.core),h=K(H.builderManager),{createAndInsertComponent:k,moveComponent:_,goToComponentParentPage:g,isDraggingAllowed:y}=ie(l,h),{getComponentInfoFromDrag:T,removeInsertionCandidacy:M,isParentSuitable:W}=le(l),{isComponentVisible:L}=ke(l),P=v,{componentId:i,matchingComponents:r}=be(P),n=m(()=>l.getComponentById(i.value)),c=x(!1),p=x(null),C=m(()=>l.getComponentDefinition(n.value.type)),I=m(()=>{var u,s;const t=((u=C.value)==null?void 0:u.name)??`Unknown (${n.value.type})`;if(n.value.type!=="html")return t;const f=(s=n.value.content)==null?void 0:s.element;return f?`${f}`:t}),e=m(()=>A.value.length==0||!C.value),b=m(()=>{var t;return!!((t=r.value)!=null&&t.some(f=>f.id==i.value))}),S=m(()=>{var oe,ae;const t=(oe=C.value)==null?void 0:oe.previewField;if(!t)return;const u=(ae=l.getComponentById(i.value).content)==null?void 0:ae[t];let s;const te=70;return(u==null?void 0:u.length)>te?s=u.substring(0,te)+"...":s=u,s}),E=m(()=>{let t=I.value;return S.value&&(t+=` · ${S.value}`),t+=` · Position: ${n.value.position}`,t}),A=m(()=>l.getComponents(i.value,{sortedByPosition:!0})),$=x(!0),q=()=>{$.value=!$.value};async function N(){g(i.value),await F(),h.setSelection(i.value,void 0,"tree"),c.value=!0}const Z=m(()=>h.getSelectedId()),X=m(()=>{var t;return Z.value==((t=n.value)==null?void 0:t.id)});J(Z,t=>{var s;if(!t)return;let u=l.getComponentById(t).parentId;for(;u;){if(u===i.value){$.value=!0;break}u=(s=l.getComponentById(u))==null?void 0:s.parentId}}),J(X,async t=>{if(t){if(!c.value){ee();return}c.value=!1}});const ee=()=>{if(!p.value)return;const t=p.value.closest(".BuilderSidebarTree"),f=t.clientHeight,u=p.value.clientHeight,s=p.value.offsetTop-(f/2-u/2);t.scrollTo({top:s,left:0,behavior:"smooth"})},pe=t=>{h.setSelection(null),t.dataTransfer.setData(`application/json;writer=${n.value.type},${n.value.id}`,"{}")},me=t=>{M(t)},ve=t=>{const f=T(t);if(!f)return;const{draggedType:u,draggedId:s}=f;W(i.value,s,u)&&t.preventDefault()},he=t=>{const f=T(t);if(!f)return;const{draggedType:u,draggedId:s}=f;s?_(s,n.value.id):k(u,n.value.id),M(t)};return Ce(()=>{X.value&&ee()}),(t,f)=>{const u=we("BuilderTreeBranch",!0);return o(),a("div",He,[d("div",{ref_key:"rootEl",ref:p,class:z(["main",{selected:X.value,childless:e.value,matching:b.value}]),title:E.value,"data-branch-component-type":n.value.type,"data-branch-component-id":j(i),tabindex:"0",draggable:j(y)(j(i)),onClick:N,onKeydown:R(N,["enter"]),onDragover:ve,onDragstart:pe,onDragend:me,onDrop:he},[e.value?w("",!0):(o(),a("div",{key:0,class:"toggleChildren",onClick:q},[$.value?(o(),a("i",qe,"expand_less")):w("",!0),$.value?w("",!0):(o(),a("i",Fe,"expand_more"))])),d("span",Re,D(I.value),1),Object.keys(n.value.handlers??{}).length>0?(o(),a(B,{key:1},[O("  · "),Ue],64)):w("",!0),j(L)(n.value.id)?w("",!0):(o(),a(B,{key:2},[O("  · "),Ge],64)),n.value.isCodeManaged?(o(),a(B,{key:3},[O("  · "),Qe],64)):w("",!0),S.value?(o(),a("span",ze,"  · "+D(S.value),1)):w("",!0)],42,We),$.value&&!e.value?(o(),a("div",Xe,[(o(!0),a(B,null,U(A.value.filter(s=>!s.isCodeManaged),s=>(o(),a("div",{key:s.id,class:"child"},[V(u,{"component-id":s.id,"matching-components":j(r)},null,8,["component-id","matching-components"])]))),128)),(o(!0),a(B,null,U(A.value.filter(s=>s.isCodeManaged),s=>(o(),a("div",{key:s.id,class:"child"},[V(u,{"component-id":s.id,"matching-components":j(r)},null,8,["component-id","matching-components"])]))),128))])):w("",!0)])}}}),Ye=Q(Je,[["__scopeId","data-v-c548a629"]]),ue=v=>(re("data-v-a3763f90"),v=v(),ce(),v),Ze={class:"BuilderSidebarTree"},et=["data-writer-tooltip"],tt=["data-writer-tooltip"],ot={ref:"componentTree",class:"components"},at={class:"add"},nt=ue(()=>d("i",{class:"material-symbols-outlined"}," add ",-1)),st=ue(()=>d("i",{class:"material-symbols-outlined"}," add ",-1)),lt=G({__name:"BuilderSidebarTree",setup(v){const l=K(H.core),h=K(H.builderManager),{createAndInsertComponent:k,goToComponentParentPage:_}=ie(l,h),g=x(null),y=x(-1),T=m(()=>{let e="root";return h.getMode()=="workflows"&&(e="workflows_root"),e}),M=m(()=>l.getComponents(null,{sortedByPosition:!0}).filter(e=>e.type==T.value));function W(e,b){var A,$;if(e.id.toLocaleLowerCase().includes(b)||e.type.toLocaleLowerCase().includes(b)||((A=l.getComponentDefinition(e.type))==null?void 0:A.name).includes(b))return!0;const E=[...Object.values(e.content??{}),...Object.values(e.handlers??{}),...Object.values(e.binding??{})];for(let q=0;q<E.length;q++){const N=($=E[q])==null?void 0:$.toString().toLocaleLowerCase();if(N!=null&&N.includes(b))return!0}return!1}async function L(){var b;const e=(b=c.value)==null?void 0:b[y.value];e&&(_(e.id),await F(),h.setSelection(e.id,void 0,"tree"))}const P=m(()=>{if(!p.value)return-1;let e=y.value-1;return e<0&&(e=c.value.length-1),e}),i=m(()=>{if(!p.value)return-1;let e=y.value+1;return e>c.value.length-1&&(e=0),e});function r(){y.value=P.value,L()}function n(){y.value=i.value,L()}const c=m(()=>{if(!g.value)return;const e=g.value.toLocaleLowerCase();return l.getComponents().filter(E=>W(E,e))});J(c,()=>{y.value=-1});const p=m(()=>{var e;return((e=c.value)==null?void 0:e.length)>0});async function C(){const e=k("page","root");l.setActivePageId(e),await F(),h.setSelection(e,void 0,"tree")}async function I(){const e=k("workflows_workflow","workflows_root");l.setActivePageId(e),await F(),h.setSelection(e,void 0,"tree")}return(e,b)=>(o(),a("div",Ze,[V(de,{modelValue:g.value,"onUpdate:modelValue":b[0]||(b[0]=S=>g.value=S),title:"Component Tree",icon:"account_tree",disabled:!p.value},{default:Se(()=>[d("i",{class:z([{disabled:!p.value},"searchIcon material-symbols-outlined"]),"data-writer-tooltip":p.value?`Go to match ${P.value+1} of ${c.value.length}`:"Previous match","data-writer-tooltip-placement":"bottom",tabindex:"0",onKeydown:R(r,["enter"]),onClick:r}," navigate_before ",42,et),d("i",{class:z([{disabled:!p.value},"searchIcon material-symbols-outlined"]),"data-writer-tooltip":p.value?`Go to match ${i.value+1} of ${c.value.length}`:"Next match","data-writer-tooltip-placement":"bottom",tabindex:"0",onKeydown:R(n,["enter"]),onClick:n}," navigate_next ",42,tt)]),_:1},8,["modelValue","disabled"]),d("div",ot,[(o(!0),a(B,null,U(M.value,S=>(o(),a("div",{key:S.id,class:"selector"},[V(Ye,{"component-id":S.id,"matching-components":c.value},null,8,["component-id","matching-components"])]))),128))],512),d("div",at,[T.value=="root"?(o(),a("button",{key:0,"data-automation-action":"add-page",onClick:C},[nt,O(" Add Page ")])):w("",!0),T.value=="workflows_root"?(o(),a("button",{key:1,"data-automation-action":"add-workflow",onClick:I},[st,O(" Add Workflow ")])):w("",!0)])]))}}),it=Q(lt,[["__scopeId","data-v-a3763f90"]]),rt={class:"BuilderSidebar"},ct=G({__name:"BuilderSidebar",setup(v){return(l,h)=>(o(),a("div",rt,[V(Ke,{class:"toolbar"}),V(it,{class:"tree"})]))}}),ut=Q(ct,[["__scopeId","data-v-e1a5c7b9"]]);export{ut as default};
