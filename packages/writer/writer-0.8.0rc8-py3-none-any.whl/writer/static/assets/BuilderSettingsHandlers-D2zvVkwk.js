import{d as X,i as x,a as V,c as g,r as D,V as Z,L as b,o as n,e as a,f as e,F as v,s as m,t as u,J as y,b as T,n as I,l as $,q as H,ar as K,au as ee,y as te,z as oe,N as se,_ as ne}from"./index-9bD4GQJ-.js";import{e as ae}from"./toggleHighContrast-Ckx2vIIx.js";import{B as j}from"./BuilderApp-DIsgKTwB.js";import"./marked.esm-273vDTCT.js";const p=k=>(te("data-v-4f2dcc36"),k=k(),oe(),k),le={key:0,class:"BuilderSettingsHandlers"},ie=p(()=>e("div",{class:"sectionTitle"},[e("i",{class:"material-symbols-outlined"},"bolt"),e("h3",null,"Events")],-1)),de={class:"list"},re={class:"columns"},ce={class:"fieldWrapperMain"},ue={class:"name"},pe=["value","onInput"],_e=["selected"],ve=["value"],me=["value"],he=["value"],fe=["value"],ye={class:"fieldActions"},ke=["onClick"],ge=p(()=>e("i",{class:"material-symbols-outlined"},"help",-1)),we=[ge],Ce={key:0,class:"desc"},be=p(()=>e("div",{class:"stubMessage"}," You can use the following stub code as a starting point for your event handler. ",-1)),$e={class:"codeContainer"},He=p(()=>e("i",{class:"material-symbols-outlined"}," content_copy ",-1)),Se={class:"customHandler"},Me=p(()=>e("i",{class:"material-symbols-outlined"},"add",-1)),Ee={class:"customHandlerModalForm"},Ne={class:"fieldWrapper"},We={class:"fieldWrapperMain"},Be=p(()=>e("span",{class:"name"},"Event type",-1)),Ae={id:"commonEventTypes"},Fe=["value"],xe=p(()=>e("span",{class:"desc"},"Can be any event type.",-1)),Ve={class:"fieldWrapper"},De=p(()=>e("div",{class:"fieldWrapperMain"},[e("span",{class:"name"},"Handler function")],-1)),Te=["value"],Ie=["value"],je=["value"],Pe=p(()=>e("span",{class:"desc"},"The function that will handle the event.",-1)),ze=p(()=>e("i",{class:"material-symbols-outlined"},"add",-1)),Le=X({__name:"BuilderSettingsHandlers",setup(k){const h=x(V.core),w=x(V.builderManager),{setHandlerValue:S}=se(h,w),r=g(()=>h.getComponentById(w.getSelectedId())),P=g(()=>{const{type:l}=r.value,{events:s}=h.getComponentDefinition(l),t={...s};return Object.keys({...r.value.handlers}).forEach(d=>{t[d]||(t[d]={desc:"Custom event"})}),t}),C=h.userFunctions,M=g(()=>h.getComponents("root").filter(t=>t.type=="page").map(t=>t.content.key).filter(t=>!!t)),E=g(()=>h.getComponents("workflows_root").filter(t=>t.type=="workflows_workflow").map(t=>t.content.key).filter(t=>!!t)),z=l=>{var t;const s=(t=r.value.handlers)==null?void 0:t[l];return!(!s||s.startsWith("$")||C.value.some(d=>d.name==s))},L=(l,s)=>{const t=l.target.value;S(r.value.id,s,t)},f=D(null),_=D(null);function O(){return`
# When dealing with a DOM event, Writer Framework generates a payload by serialising its
# primitive properties (non-Object, non-function properties).

# If the event is instead an instance of CustomEvent,
# it looks for a "payload" property inside the CustomEvent's "detail" property. 

def handle_keydown(state, payload):
	print(payload) # Shows all the properties captured

	key_activated = payload.get("key")
	if key_activated == "ArrowLeft":
		state["position"] += -10
	elif key_activated == "ArrowRight":
		state["position"] += 10

	`}function N(l){const{type:s}=r.value,{events:t}=h.getComponentDefinition(s),d=t==null?void 0:t[l];return d?d==null?void 0:d.stub:O()}async function R(l){const s=N(l),t=await ae.colorize(s.trim(),"python",{});f.value={modalTitle:`"${l}" event`,code:s,highlightedCodeHtml:t}}const G=["click","mousedown","mouseup","mouseenter","mouseleave","mousemove","keydown","keyup","keypress","input","change","submit","focus","blur","resize","scroll","load"];function U(){const{eventType:l,handlerFunctionName:s}=_.value;S(r.value.id,l,s),_.value=null}const q={desc:"Close",fn:()=>{f.value=null}};function J(){_.value={eventType:null,handlerFunctionName:null}}const Y={desc:"Close",fn:()=>{_.value=null}},Q=l=>{navigator.clipboard.writeText(l)};return(l,s)=>{var d;const t=Z("dompurify-html");return b(w).isSelectionActive()?(n(),a("div",le,[ie,e("div",de,[(n(!0),a(v,null,m(P.value,(o,c)=>{var W,B,A,F;return n(),a("div",{key:c,class:"fieldWrapper"},[e("div",re,[e("div",ce,[e("span",ue,u(c),1),e("select",{class:"content",value:(W=r.value.handlers)==null?void 0:W[c],onInput:i=>L(i,c)},[e("option",{key:"No handler",value:"",selected:!((B=r.value.handlers)!=null&&B[c])}," (No handler) ",8,_e),(n(!0),a(v,null,m(b(C),i=>(n(),a("option",{key:i.name,value:i.name},u(i.name),9,ve))),128)),(n(!0),a(v,null,m(M.value,i=>(n(),a("option",{key:`$goToPage_${i}`,value:`$goToPage_${i}`},' Go to page "'+u(i)+'" ',9,me))),128)),(n(!0),a(v,null,m(E.value,i=>(n(),a("option",{key:`$runWorkflow_${i}`,value:`$runWorkflow_${i}`},' Run workflow "'+u(i)+'" ',9,he))),128)),z(c)?(n(),a("option",{key:0,value:(A=r.value.handlers)==null?void 0:A[c]},u((F=r.value.handlers)==null?void 0:F[c])+" (Not Found) ",9,fe)):y("",!0)],40,pe)]),e("div",ye,[N(c)?(n(),a("button",{key:0,variant:"subtle",title:"Show event handler stub",onClick:i=>R(c)},we,8,ke)):y("",!0)])]),o!=null&&o.desc?(n(),a("div",Ce,u(o.desc),1)):y("",!0)])}),128))]),f.value?(n(),T(j,{key:0,"close-action":q,icon:"help","modal-title":(d=f.value)==null?void 0:d.modalTitle},{default:I(()=>[be,e("div",$e,[$(e("code",null,null,512),[[t,f.value.highlightedCodeHtml]])]),e("button",{onClick:s[0]||(s[0]=o=>Q(f.value.code))},[He,H(" Copy code to clipboard ")])]),_:1},8,["modal-title"])):y("",!0),e("div",Se,[e("button",{title:"Add a custom event handler",onClick:J},[Me,H("Add custom handler ")]),_.value?(n(),T(j,{key:0,"close-action":Y,icon:"bolt","modal-title":"Add Custom Event Handler"},{default:I(()=>[e("div",Ee,[e("div",Ne,[e("div",We,[Be,$(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>_.value.eventType=o),class:"content",type:"text",list:"commonEventTypes"},null,512),[[K,_.value.eventType]]),e("datalist",Ae,[(n(),a(v,null,m(G,o=>e("option",{key:o,value:o},u(o),9,Fe)),64))])]),xe]),e("div",Ve,[De,$(e("select",{"onUpdate:modelValue":s[2]||(s[2]=o=>_.value.handlerFunctionName=o),class:"content"},[(n(!0),a(v,null,m(b(C),o=>(n(),a("option",{key:o.name,value:o.name},u(o.name),9,Te))),128)),(n(!0),a(v,null,m(M.value,o=>(n(),a("option",{key:`$goToPage_${o}`,value:`$goToPage_${o}`},' Go to page "'+u(o)+'" ',9,Ie))),128)),(n(!0),a(v,null,m(E.value,o=>(n(),a("option",{key:`$runWorkflow_${o}`,value:`$runWorkflow_${o}`},' Run workflow "'+u(o)+'" ',9,je))),128))],512),[[ee,_.value.handlerFunctionName]]),Pe])]),e("button",{onClick:s[3]||(s[3]=o=>U())},[ze,H("Add ")])]),_:1})):y("",!0)])])):y("",!0)}}}),qe=ne(Le,[["__scopeId","data-v-4f2dcc36"]]);export{qe as default};
