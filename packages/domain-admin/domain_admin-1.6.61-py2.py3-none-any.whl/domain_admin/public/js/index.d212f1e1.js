import{H as P}from"./highlight-lib.2ee09073.js";import{_ as B}from"./index.6b51fc55.js";import{ai as m,o as A,c as k,U as d,O as g,a as w,T as z,S as N,aq as Z,P as G}from"./vendor-vue.279aabbf.js";import{h as x}from"./highlight-util.7ff64d2a.js";import"./element-plus.2186919a.js";import"./element-icon.a3660786.js";import"./vendor-lib.c8503388.js";const Q={name:"",components:{},props:{list:{type:Array}},computed:{},data(){return{currentRow:null,dialogVisible:!1}},methods:{handleEditRow(n){this.currentRow=n,this.dialogVisible=!0},async handleDeleteClick(n){let e={id:n.id};const t=await this.$http.function(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},async handleStatusChange(n){let e={id:n.id};const t=await this.$http.function(e);t.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.$emit("on-success")):this.$msg.error(t.msg)},handleUpdateSuccess(){this.$emit("on-success")}},mounted(){P.highlightAll()},created(){}},X={key:0},Y=["innerHTML"],K={key:1},ee=["innerHTML"];function te(n,e,t,i,s,o){const r=m("el-table-column"),l=m("el-tag"),u=m("el-table");return A(),k("div",null,[d(u,{data:t.list,stripe:"",border:""},{default:g(()=>[d(r,{label:n.$t("\u64CD\u4F5C\u4EBA"),"header-align":"center",align:"center",width:"100",prop:"user_name","show-overflow-tooltip":""},{default:g(a=>[w("span",null,z(a.row.user_name||"-"),1)]),_:1},8,["label"]),d(r,{label:n.$t("\u64CD\u4F5C\u8868"),width:"120","header-align":"center",align:"center",prop:"table","show-overflow-tooltip":""},{default:g(a=>[w("span",null,z(a.row.table||"-"),1)]),_:1},8,["label"]),d(r,{label:n.$t("\u64CD\u4F5C\u7C7B\u578B"),"header-align":"center",align:"center",prop:"type_id",width:"100"},{default:g(a=>[d(l,{type:a.row.type_style},{default:g(()=>[N(z(a.row.type_label),1)]),_:2},1032,["type"])]),_:1},8,["label"]),d(r,{label:n.$t("\u6570\u636E\u53D8\u5316"),"header-align":"center",align:"left",prop:"type_id"},{default:g(a=>[a.row.type_style==""?(A(),k("pre",X,[w("code",{class:"language-diff",innerHTML:a.row.data},null,8,Y)])):(A(),k("pre",K,[w("code",{class:"language-json",innerHTML:a.row.data},null,8,ee)]))]),_:1},8,["label"]),d(r,{label:n.$t("\u64CD\u4F5C\u65F6\u95F4"),"header-align":"center",align:"center",prop:"create_time",width:"130"},{default:g(a=>[w("span",null,z(a.row.create_time_label||"-"),1)]),_:1},8,["label"])]),_:1},8,["data"])])}const ne=B(Q,[["render",te]]),O={CREATE:1,UPDATE:2,DELETE:3,BATCH_DELETE:4};function v(){}v.prototype={diff:function(e,t){var i,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=s.callback;typeof s=="function"&&(o=s,s={}),this.options=s;var r=this;function l(c){return o?(setTimeout(function(){o(void 0,c)},0),!0):c}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var u=t.length,a=e.length,h=1,p=u+a;s.maxEditLength&&(p=Math.min(p,s.maxEditLength));var _=(i=s.timeout)!==null&&i!==void 0?i:1/0,D=Date.now()+_,f=[{oldPos:-1,lastComponent:void 0}],y=this.extractCommon(f[0],t,e,0);if(f[0].oldPos+1>=a&&y+1>=u)return l([{value:this.join(t),count:t.length}]);var E=-1/0,T=1/0;function V(){for(var c=Math.max(E,-h);c<=Math.min(T,h);c+=2){var C=void 0,L=f[c-1],$=f[c+1];L&&(f[c-1]=void 0);var R=!1;if($){var H=$.oldPos-c;R=$&&0<=H&&H<u}var J=L&&L.oldPos+1<a;if(!R&&!J){f[c]=void 0;continue}if(!J||R&&L.oldPos+1<$.oldPos?C=r.addToPath($,!0,void 0,0):C=r.addToPath(L,void 0,!0,1),y=r.extractCommon(C,t,e,c),C.oldPos+1>=a&&y+1>=u)return l(oe(r,C.lastComponent,t,e,r.useLongestToken));f[c]=C,C.oldPos+1>=a&&(T=Math.min(T,c-1)),y+1>=u&&(E=Math.max(E,c+1))}h++}if(o)(function c(){setTimeout(function(){if(h>p||Date.now()>D)return o();V()||c()},0)})();else for(;h<=p&&Date.now()<=D;){var q=V();if(q)return q}},addToPath:function(e,t,i,s){var o=e.lastComponent;return o&&o.added===t&&o.removed===i?{oldPos:e.oldPos+s,lastComponent:{count:o.count+1,added:t,removed:i,previousComponent:o.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:i,previousComponent:o}}},extractCommon:function(e,t,i,s){for(var o=t.length,r=i.length,l=e.oldPos,u=l-s,a=0;u+1<o&&l+1<r&&this.equals(t[u+1],i[l+1]);)u++,l++,a++;return a&&(e.lastComponent={count:a,previousComponent:e.lastComponent}),e.oldPos=l,u},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],i=0;i<e.length;i++)e[i]&&t.push(e[i]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}};function oe(n,e,t,i,s){for(var o=[],r;e;)o.push(e),r=e.previousComponent,delete e.previousComponent,e=r;o.reverse();for(var l=0,u=o.length,a=0,h=0;l<u;l++){var p=o[l];if(p.removed){if(p.value=n.join(i.slice(h,h+p.count)),h+=p.count,l&&o[l-1].added){var D=o[l-1];o[l-1]=o[l],o[l]=D}}else{if(!p.added&&s){var _=t.slice(a,a+p.count);_=_.map(function(y,E){var T=i[h+E];return T.length>y.length?T:y}),p.value=n.join(_)}else p.value=n.join(t.slice(a,a+p.count));a+=p.count,p.added||(h+=p.count)}}var f=o[u-1];return u>1&&typeof f.value=="string"&&(f.added||f.removed)&&n.equals("",f.value)&&(o[u-2].value+=f.value,o.pop()),o}var j=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,U=/\S/,F=new v;F.equals=function(n,e){return this.options.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n===e||this.options.ignoreWhitespace&&!U.test(n)&&!U.test(e)};F.tokenize=function(n){for(var e=n.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<e.length-1;t++)!e[t+1]&&e[t+2]&&j.test(e[t])&&j.test(e[t+2])&&(e[t]+=e[t+2],e.splice(t+1,2),t--);return e};var W=new v;W.tokenize=function(n){this.options.stripTrailingCr&&(n=n.replace(/\r\n/g,`
`));var e=[],t=n.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var i=0;i<t.length;i++){var s=t[i];i%2&&!this.options.newlineIsToken?e[e.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),e.push(s))}return e};var ie=new v;ie.tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)};var se=new v;se.tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};function S(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?S=function(e){return typeof e}:S=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(n)}var re=Object.prototype.toString,b=new v;b.useLongestToken=!0;b.tokenize=W.tokenize;b.castInput=function(n){var e=this.options,t=e.undefinedReplacement,i=e.stringifyReplacer,s=i===void 0?function(o,r){return typeof r>"u"?t:r}:i;return typeof n=="string"?n:JSON.stringify(M(n,null,null,s),s,"  ")};b.equals=function(n,e){return v.prototype.equals.call(b,n.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"))};function M(n,e,t,i,s){e=e||[],t=t||[],i&&(n=i(s,n));var o;for(o=0;o<e.length;o+=1)if(e[o]===n)return t[o];var r;if(re.call(n)==="[object Array]"){for(e.push(n),r=new Array(n.length),t.push(r),o=0;o<n.length;o+=1)r[o]=M(n[o],e,t,i,s);return e.pop(),t.pop(),r}if(n&&n.toJSON&&(n=n.toJSON()),S(n)==="object"&&n!==null){e.push(n),r={},t.push(r);var l=[],u;for(u in n)n.hasOwnProperty(u)&&l.push(u);for(l.sort(),o=0;o<l.length;o+=1)u=l[o],r[u]=M(n[u],e,t,i,u);e.pop(),t.pop()}else r=n;return r}var I=new v;I.tokenize=function(n){return n.slice()};I.join=I.removeEmpty=function(n){return n};function ae(n,e,t){return I.diff(n,e,t)}const le={name:"log_operation-list",props:{},components:{DataTable:ne},data(){return{list:[],total:0,page:1,size:20,keyword:"",loading:!0,dialogVisible:!1,pageSizeCachekey:"pageSize"}},computed:{},methods:{resetData(){this.page=1,this.list=[],this.getData()},async getData(){this.loading=!0;let n={page:this.page,size:this.size,keyword:this.keyword};try{const e=await this.$http.getOperationLogList(n);e.code==0&&(this.list=e.data.list.map(t=>{try{t.before=JSON.stringify(JSON.parse(t.before),null,2)}catch{}try{t.after=JSON.stringify(JSON.parse(t.after),null,2)}catch{}if(t.type_id==O.UPDATE){let s=ae(t.before.split(`
`),t.after.split(`
`)).map(o=>o.added?o.value.map(r=>"+"+r).join(`
`):o.removed?o.value.map(r=>"-"+r).join(`
`):o.value.map(r=>r).join(`
`));t.data=x(s.join(`
`),{language:"diff"}).value,t.type_style=""}else t.type_id==O.CREATE?(t.data=x(t.after,{language:"json"}).value,t.type_style="success"):t.type_id==O.DELETE?(t.data=x(t.before,{language:"json"}).value,t.type_style="danger"):t.type_id==O.BATCH_DELETE&&(t.data=x(t.before,{language:"json"}).value,t.type_style="danger");return t}),this.total=e.data.total)}catch(e){console.log(e)}finally{this.loading=!1}},handleAddRow(){this.dialogVisible=!0},handleAddSuccess(){this.resetData()},getObjectString(n){let e=[];for(let[t,i]of Object.entries(n))e.push(`${t}: ${i}`);return e.join(`
`)},handleSearch(){this.resetData()},handleSizeChange(n){localStorage.setItem(this.pageSizeCachekey,n),this.resetData()},loadPageSize(){let n=localStorage.getItem(this.pageSizeCachekey);n&&(this.size=parseInt(n))},async clearLogOperationList(){let n=this.$loading({fullscreen:!0});try{const e=await this.$http.clearLogOperationList();e.code==0?(this.$msg.success("\u64CD\u4F5C\u6210\u529F"),this.resetData()):this.$msg.error(e.msg)}catch(e){console.log(e)}finally{this.$nextTick(()=>{n.close()})}}},created(){this.loadPageSize(),this.getData()}},ue={class:"app-container"},pe={class:"flex justify-end mb-sm"};function fe(n,e,t,i,s,o){const r=m("Delete"),l=m("el-icon"),u=m("el-link"),a=m("el-popconfirm"),h=m("Refresh"),p=m("DataTable"),_=m("el-pagination"),D=Z("loading");return A(),k("div",ue,[w("div",pe,[e[2]||(e[2]=w("div",null,null,-1)),d(a,{title:"\u786E\u5B9A\u6E05\u7A7A\u65E5\u5FD7\uFF1F",onConfirm:o.clearLogOperationList},{reference:g(()=>[d(u,{underline:!1,type:"danger",class:"mr-sm"},{default:g(()=>[d(l,null,{default:g(()=>[d(r)]),_:1}),N(z(n.$t("\u6E05\u7A7A\u65E5\u5FD7")),1)]),_:1})]),_:1},8,["onConfirm"]),d(u,{underline:!1,type:"primary",disabled:s.loading,onClick:o.getData},{default:g(()=>[d(l,null,{default:g(()=>[d(h)]),_:1}),N(z(n.$t("\u5237\u65B0")),1)]),_:1},8,["disabled","onClick"])]),G(d(p,{list:s.list,onOnSuccess:o.resetData},null,8,["list","onOnSuccess"]),[[D,s.loading]]),d(_,{class:"mt-md justify-center",background:"",layout:"total, sizes, prev, pager, next",total:s.total,"page-size":s.size,"onUpdate:pageSize":e[0]||(e[0]=f=>s.size=f),"current-page":s.page,"onUpdate:currentPage":e[1]||(e[1]=f=>s.page=f),onCurrentChange:o.getData,onSizeChange:o.handleSizeChange},null,8,["total","page-size","current-page","onCurrentChange","onSizeChange"])])}const ye=B(le,[["render",fe]]);export{ye as default};
