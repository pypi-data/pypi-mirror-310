from .context import gpytoolbox as gpy
from .context import numpy as np
from .context import unittest

class TestReadDmat(unittest.TestCase):
    def test_matlab_ascii(self):
        W = gpy.read_dmat('test/unit_tests_data/ascii_W.dmat')
        # print(W)
        Wbin = gpy.read_dmat('test/unit_tests_data/bin_W.dmat')
        # print(Wbin)
        self.assertTrue(np.allclose(W,Wbin))
        W_gt = np.array([[0.9999977045844705, 1.455759492051292e-09, 8.185489445018793e-12, 1.619459116313936e-11, 2.012372714281619e-06, 2.815626757523364e-07], [0.9983872648074058, 1.108080271541166e-09, 0.00161036571302195, 5.689350247487697e-11, 2.056753515235565e-06, 3.11561083489612e-07], [0.9901654027609034, 0.0001211512742864639, 0.007010299253766364, 0.002700756969264206, 2.033999632084496e-06, 3.557421474679243e-07], [0.9692778999878779, 0.0006634670335592213, 0.01868009697599276, 0.01137612589476107, 1.975908218564513e-06, 4.341995903301764e-07], [0.9269029272879321, 0.002085407377937788, 0.04090499621002365, 0.03010428179213873, 1.828740359862888e-06, 5.585916077658179e-07], [0.8629849909516513, 0.004621525078446085, 0.07452311658641603, 0.05786805066729514, 1.604267526335175e-06, 7.124486651500068e-07], [0.7652857778270644, 0.009140792028952094, 0.1281382960794982, 0.09743297557647897, 1.273300958486119e-06, 8.851870478211291e-07], [0.639793818966754, 0.0157562764038658, 0.2048546358460041, 0.1395931935918658, 1.0483888414707e-06, 1.026802668671472e-06], [0.4562851998405815, 0.02565122384299602, 0.3441792371556869, 0.1738817749235592, 1.431318333049086e-06, 1.132918843210353e-06], [0.2890558692494374, 0.0287293220549815, 0.5277224192714496, 0.154488237391903, 2.944039681421703e-06, 1.207992546821451e-06], [0.2059942246815925, 0.02185008344249662, 0.656673069037053, 0.115477196632807, 4.159240572154357e-06, 1.26696547865984e-06], [0.1578229180129864, 0.01626179325914419, 0.7372328795735804, 0.08867631673561684, 4.81280387521867e-06, 1.279614796971105e-06], [0.1183557448785696, 0.01066774859135517, 0.8069946666277669, 0.06397543255078081, 5.160738927366343e-06, 1.246612600359668e-06], [0.08739543453939301, 0.006156780758887974, 0.8625491618379014, 0.04389224462209174, 5.203182821678678e-06, 1.175058904396267e-06], [0.06371578125193386, 0.003080323582379759, 0.9043376356215557, 0.02886017884421635, 5.003407550163495e-06, 1.077292364356741e-06], [0.04513324571973126, 0.001115757603668193, 0.9361970331413397, 0.01754835473020813, 4.64479363923664e-06, 9.640114135348643e-07], [0.0317434579663936, 0.0002113252826172984, 0.9579312656688892, 0.01010890004513337, 4.201885572406086e-06, 8.491513942696519e-07], [0.0214901652336135, 2.304715370597851e-10, 0.973305851956556, 0.005199559853665681, 3.692299299639521e-06, 7.304263935156619e-07], [0.01262671050690559, 2.147078592279965e-10, 0.9856153051497138, 0.001754312706948438, 3.075559646210843e-06, 5.958620781027205e-07], [0.005972391064864485, 2.33947795944318e-09, 0.9938751217042064, 0.0001496201835211494, 2.407468493597889e-06, 4.572394364771345e-07], [0.001573991447741945, 9.627669698405058e-08, 0.9984238173163068, 1.679995627260143e-11, 1.766713197872383e-06, 3.282292564392119e-07], [1.750908486295817e-10, 7.320468959800888e-09, 0.9999985133216961, 5.457777774214556e-10, 1.251420910035949e-06, 2.272160563237485e-07], [1.640641423521692e-10, 1.057879357737911e-10, 0.999998724948727, 1.651665564714779e-10, 1.081447828166946e-06, 1.931684260530897e-07], [1.142476465593943e-07, 0.0001530295268897276, 0.9998454330512598, 1.488532643558551e-11, 1.209270333426973e-06, 2.138889852959038e-07], [5.597907561279761e-10, 0.001732203491521193, 0.9980532799905892, 0.0002127118829783847, 1.535022206954166e-06, 2.690529134709196e-07], [9.724223234749952e-11, 0.00514398199850491, 0.9923735232044993, 0.002480135952810862, 2.010357535713844e-06, 3.483894070045047e-07], [0.0001919029151733809, 0.01035785966226867, 0.9821740109077023, 0.007273313048256179, 2.488827992306708e-06, 4.246386071240653e-07], [0.001744096795503155, 0.01879418973616199, 0.9633711476233173, 0.0160869714686494, 3.080034208100192e-06, 5.143421600567499e-07], [0.005303880338393034, 0.03075215918327326, 0.9344717560289838, 0.02946792207672121, 3.684765203267313e-06, 5.976074252627564e-07], [0.01212459078506731, 0.04996669915389599, 0.8865152069791952, 0.05138843833186214, 4.385715586967454e-06, 6.790343923487936e-07], [0.02143440625295208, 0.07545723726481673, 0.8229890292083823, 0.08011362677403584, 4.978865022090056e-06, 7.216347907359295e-07], [0.03242688240531913, 0.1093803115077648, 0.7420961839232934, 0.1160905329330588, 5.385854404243368e-06, 7.03376159755875e-07], [0.0432064622711884, 0.1543967629527765, 0.6443496520604539, 0.1580409386589719, 5.572750133164646e-06, 6.113064762157407e-07], [0.05282577845745867, 0.2413271929686489, 0.4858075655601052, 0.2200334221064907, 5.656545256812881e-06, 3.843620399116589e-07], [0.04339079555104269, 0.3836683728569427, 0.3222383767783549, 0.2506962435835759, 6.069788632382883e-06, 1.414414511988428e-07], [0.0293841193304371, 0.5274171904911329, 0.2137390872924199, 0.229453221655061, 6.328532181784182e-06, 5.269876726852599e-08], [0.01866310667852604, 0.6511655693077437, 0.1447846503981304, 0.1853805023617587, 6.134416751711129e-06, 3.683708951469584e-08], [0.01086295065327532, 0.7616176170877117, 0.09388210026623764, 0.1336317991763356, 5.436287845717986e-06, 9.652859403544648e-08], [0.00609974394673439, 0.8450136282822452, 0.05974138128687154, 0.08914062873829985, 4.466324547498258e-06, 1.514213015578041e-07], [0.003243213011671577, 0.9053466969021492, 0.03640873707699711, 0.05499774271435003, 3.425868687238011e-06, 1.844261450120685e-07], [0.001265639189959732, 0.9547664056327039, 0.01800870156385665, 0.0259567080314402, 2.334645315829159e-06, 2.109367238965615e-07], [0.0003755332238514701, 0.9816834718334116, 0.007894267727899177, 0.01004497747369483, 1.539846209815689e-06, 2.098949332824376e-07], [2.523649960309725e-05, 0.9954883354042723, 0.002315797592250056, 0.002169437083114157, 9.92286516707868e-07, 2.011342436620487e-07], [4.176256903143764e-10, 0.999999229614734, 1.444924103562841e-11, 6.715733472754435e-12, 5.931554720725289e-07, 1.76791003335345e-07], [2.649772818560491e-09, 0.9999993979823149, 3.995473928625704e-12, 1.443927606817887e-11, 4.406143443974013e-07, 1.587351330294804e-07], [2.363865315991038e-09, 0.999999384803688, 7.056163926034962e-12, 6.486872817368818e-12, 4.657006397225973e-07, 1.47118263976402e-07], [4.884559166603449e-10, 0.9996334625864809, 4.530444944721057e-12, 0.0003658798949939507, 5.413030505097227e-07, 1.157224881964317e-07], [9.425421960666964e-05, 0.9910478602293091, 0.001423024065296228, 0.00743399472173474, 7.967444251149478e-07, 7.001962822416305e-08], [0.0006744902002704222, 0.9638233955029472, 0.007126034213933407, 0.02837466964894492, 1.407330074635372e-06, 3.103829436113861e-09], [0.002490505865208344, 0.8996532964754692, 0.02135176798755131, 0.07650191014790987, 2.519435486301243e-06, 8.837473605965056e-11], [0.00632272645933281, 0.7867502108858699, 0.04495523036676081, 0.1617816658845321, 3.823049020615668e-06, 0.0001863433544837955], [0.01184177520563737, 0.6393923690313811, 0.07041252502896797, 0.2770537922772571, 4.631805666602845e-06, 0.001294906651089993], [0.01737399228916632, 0.4665628433105888, 0.08525616301436399, 0.4254089936768496, 4.473799128887714e-06, 0.005393533909902267], [0.01737948038172337, 0.3132959174079027, 0.07525124359863365, 0.5779332423032646, 3.554308604375154e-06, 0.01613656199987143], [0.01134743605642808, 0.1988862460520029, 0.05106270499242607, 0.6993804670302651, 2.512487426365054e-06, 0.03932063338145146], [0.005579692292049419, 0.1275984440619447, 0.03104978137857752, 0.760692403797084, 1.655396924175328e-06, 0.07507802307342007], [0.001923054637728861, 0.08139442854752141, 0.0171304476978931, 0.7743695988103361, 9.912406723342395e-07, 0.1251814790658482], [0.0002905206290534896, 0.04930143094569318, 0.00808458456037294, 0.7473721544190873, 5.626986772906548e-07, 0.1949507467471158], [5.391357845673703e-10, 0.02857496392681416, 0.0031505968044619, 0.6918921919478751, 2.868066116607193e-07, 0.2763819599751015], [2.861582881304681e-09, 0.01554958352416336, 0.0008684935669295549, 0.6132051103475582, 1.942625923946831e-07, 0.3703766154371735], [4.544936588911251e-07, 0.007527589407697482, 9.636038943968359e-05, 0.5150516705210388, 3.27159525198641e-07, 0.4773235980286398], [1.211047771765885e-06, 0.003206297102832075, 4.578200466714426e-11, 0.4130409839509162, 5.508600357387446e-07, 0.5837509569926622], [1.76463084818741e-06, 0.001075079813255842, 5.148060898530696e-10, 0.3132643090387005, 7.458468157459252e-07, 0.6856581001555737], [1.971417345664366e-06, 0.000220626774076335, 1.471066975785019e-07, 0.2217004597056176, 9.796864023497659e-07, 0.7780758153098606], [1.815482967412543e-06, 5.391957463267057e-09, 2.399357577016147e-07, 0.1387111025590804, 1.162412428134255e-06, 0.8612856742178088], [1.375965412257025e-06, 5.067140637192184e-09, 2.449246271357495e-07, 0.07148178179700833, 1.137279965771553e-06, 0.9285154549658459], [7.642481535072121e-07, 2.359807881044724e-07, 1.659683795678353e-07, 0.02490174972226697, 8.119310020742817e-07, 0.9750962721494096], [3.931236283461742e-07, 2.803367185011533e-07, 9.897756943522815e-08, 0.006477250765871016, 5.135364250994224e-07, 0.9935214632597875], [9.466099556563005e-08, 1.646337340480833e-07, 3.004466116622804e-08, 3.827660842744962e-13, 1.77565886920356e-07, 0.9999995330943396], [2.563708127043372e-07, 2.908759484861054e-07, 7.542317543139593e-08, 1.336693802048789e-12, 3.379818872903498e-07, 0.9999990393468394], [7.971826036142693e-07, 4.874513780373785e-07, 2.015760581763222e-07, 0.01258500738057894, 6.97059690563173e-07, 0.9874128093496908], [1.323295714454333e-06, 5.267125196042726e-07, 3.051156473656333e-07, 0.03755456428066696, 8.262969916023632e-07, 0.96244245429846], [1.758082402159859e-06, 4.521414429474668e-07, 3.70368129878132e-07, 0.07130819806646603, 7.165217853379038e-07, 0.9286885048197737], [2.204961059891008e-06, 2.704706868083705e-07, 4.104734660531498e-07, 0.1245266231452155, 3.72267906561298e-07, 0.8754701186816652], [2.532260135162332e-06, 1.165795209031468e-07, 3.999960501636495e-07, 0.1968690484473079, 2.680270365539825e-09, 0.8031279000367154], [2.635646345928875e-06, 3.199551823180799e-09, 3.357912105109614e-07, 0.2830099756632493, 1.005105063397878e-09, 0.7169870486945372], [2.457959308187552e-06, 3.412887691016575e-10, 2.237517738056188e-07, 0.3861285730648455, 0.0004335433019691486, 0.6134352015808144], [2.05371310981868e-06, 1.877676430558418e-10, 1.274572131012055e-07, 0.4901648356242211, 0.002838227086548807, 0.5069947559311395], [1.414880581684808e-06, 1.955847303912169e-10, 5.179444003229731e-08, 0.6014821423313029, 0.009789418060770166, 0.3887269727373205], [6.885512180986865e-07, 4.266932259634969e-09, 9.043415771675868e-10, 0.7105435036821364, 0.0290808572980431, 0.2603749452973286], [1.495976288901504e-10, 1.469105464006214e-10, 9.489612612110133e-11, 0.7914357862334851, 0.08960548699885908, 0.1189587263762516], [1.470982840275479e-10, 5.048008688441942e-10, 3.611364641000936e-08, 0.7294640180341311, 0.2323079232717291, 0.03822802192859433], [2.181584665343936e-10, 8.296154952398723e-07, 1.064129071297993e-07, 0.6010083559042928, 0.3864859104339395, 0.0125047974152069], [5.128601312281846e-10, 1.664675839779972e-06, 2.079430374198249e-07, 0.4676229766012844, 0.5291600724425425, 0.003215077824435611], [1.202171862254164e-08, 2.264774049830656e-06, 3.577200313891596e-07, 0.3432615323636405, 0.6563053682313561, 0.0004304648892035634], [2.771711892815201e-07, 2.522493701508497e-06, 4.743220647484125e-07, 0.2458429786722424, 0.7541537471932331, 1.475689405040829e-10], [6.120739777494555e-07, 2.529621751511467e-06, 5.358174945053538e-07, 0.1722994397103722, 0.8276968825639602, 2.124436761213279e-10], [9.085921053111065e-07, 2.339896811845025e-06, 5.420216478679182e-07, 0.1144519933213883, 0.8855441323639642, 8.380408255198291e-08], [1.091284865425825e-06, 2.041124881820834e-06, 5.068529058645131e-07, 0.0702100137528913, 0.9297861900227319, 1.569617236822956e-07], [1.146628635292806e-06, 1.687023772956547e-06, 4.430933077599733e-07, 0.03887427237328797, 0.9611222578333496, 1.930476464432437e-07], [1.007632469296875e-06, 1.18235554561063e-06, 3.283762700850047e-07, 0.01390318876213896, 0.9860941099230777, 1.829504984348726e-07], [6.340534074876075e-07, 5.973808729452738e-07, 1.746787958313615e-07, 0.001710686682705884, 0.9982877907998952, 1.164043228197832e-07], [2.091735985450849e-07, 1.020412264479355e-07, 3.53450458411069e-08, 2.879720334564895e-13, 0.9999996201048513, 3.333498980711626e-08], [1.298781549477761e-07, 1.118818090156036e-07, 3.480001497635541e-08, 1.007793947819386e-11, 0.9999996859191699, 3.751077308833064e-08], [1.439767679313275e-07, 5.492988043782112e-07, 1.356601865595211e-07, 0.02583324114792827, 0.974165809978835, 1.199374778060704e-07], [1.487150978667268e-09, 1.069841808939582e-06, 2.206827122507105e-07, 0.07904083928181238, 0.920957688275896, 1.804306195191413e-07], [1.686789175234375e-07, 1.576184372650366e-06, 2.572484762268186e-07, 0.1661871678405231, 0.8338106382225622, 1.918251483407593e-07], [0.0003569727185191231, 1.672762369261135e-06, 2.164858804973369e-07, 0.266928686501243, 0.732712310669901, 1.408620871522414e-07], [0.001583135882330856, 1.402545548408646e-06, 1.377299521588419e-10, 0.3733773250535445, 0.6250380548159721, 8.156487422495955e-08], [0.004631987206147035, 8.12398163385708e-07, 1.612477296829868e-05, 0.4866031304720164, 0.5087479058551551, 3.929554994875543e-08], [0.01096625229708086, 2.195128203425112e-08, 0.0004156040109340326, 0.5980533461916018, 0.3905647457176995, 2.983140173379776e-08], [0.02174980603958763, 4.351305739080909e-10, 0.002266949667013743, 0.687722541321507, 0.2882606681000194, 3.443674171538918e-08], [0.03821645248177341, 7.232315302762294e-05, 0.006414129055169823, 0.7536624258499938, 0.2016345982183647, 7.124167053170152e-08], [0.06749696087422248, 0.001315758854752145, 0.01549684556985928, 0.7906222070135888, 0.1250680534116709, 1.742759063615849e-07], [0.1058173100327045, 0.004428740391407721, 0.02878163570946438, 0.7871243641033715, 0.07384767086685375, 2.788961982491102e-07], [0.1325345253053875, 0.006970963033094816, 0.0381654071339322, 0.7685035283478349, 0.05382524031875923, 3.358609914055305e-07], [0.1625536923456682, 0.009926028651374482, 0.04862035184896599, 0.7405784834713691, 0.03832106237060842, 3.813120138396862e-07], [0.2418929373504496, 0.01602587438352272, 0.0722506828776611, 0.6521448581542203, 0.01768518263256071, 4.646015855407475e-07], [0.3960827752127735, 0.0207180770243824, 0.1012626813125613, 0.477374521434224, 0.004561344829982633, 6.001860762668805e-07], [0.5818200598397837, 0.01538014171974143, 0.09431096439626944, 0.3075479999916226, 0.0009401450180337426, 6.890345491730676e-07], [0.7456215932914079, 0.008652907815705572, 0.06462067237366578, 0.1810344435242957, 6.97675020771754e-05, 6.154928480782818e-07], [0.8675427055241254, 0.00396472753825221, 0.03436611346114577, 0.0941260111105749, 1.850909833065085e-09, 4.405149919601714e-07], [0.949946803271152, 0.001225849830682322, 0.01177494530921525, 0.03705199202669465, 1.550546078195656e-07, 2.545076481294832e-07], [0.9902338475072879, 0.0001252486891179989, 0.001352532613143377, 0.008287566717050242, 6.54024430365737e-07, 1.504489701916198e-07], [0.9996192964334965, 3.544151440831866e-10, 1.959819297152713e-12, 0.0003795582535854151, 1.007690819654447e-06, 1.372657235870366e-07], [0.9999984695297123, 4.736001934511991e-09, 3.231470947901106e-11, 1.012546160716552e-11, 1.356853006545201e-06, 1.688388389164262e-07], [0.9999980406873188, 1.520895535082844e-07, 2.803673902334938e-08, 1.504019774725958e-10, 1.581291729716228e-06, 1.97744257005733e-07], [0.9999976917471906, 2.442387018764456e-07, 2.401386809114424e-10, 8.136902528800416e-08, 1.757763760447615e-06, 2.246411831768936e-07], [0.9999976289308503, 2.227350351016953e-07, 5.914173372703423e-12, 1.473941707621106e-09, 1.896421659283702e-06, 2.504325995534595e-07]])
        self.assertTrue(np.allclose(W,W_gt))
        self.assertTrue(np.allclose(Wbin,W_gt))
if __name__ == '__main__':
    unittest.main()
